<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - BotEngine</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #f8fafc;
        }
        
        .header {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(14, 165, 233, 0.3);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
            border-color: transparent;
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.4);
        }
        
        .btn-secondary {
            background: transparent;
            border-color: rgba(148, 163, 184, 0.3);
            color: #cbd5e1;
        }
        
        .btn-secondary:hover {
            border-color: #0ea5e9;
            color: #0ea5e9;
        }
        
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 40px;
        }
        
        .section {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(14, 165, 233, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #0ea5e9;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            color: #cbd5e1;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        input[type="text"],
        input[type="tel"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 10px;
            color: #f8fafc;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        input:focus,
        textarea:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .save-notification {
            position: fixed;
            top: 100px;
            right: 40px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .price-item {
            background: rgba(15, 23, 42, 0.6);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            margin-bottom: 15px;
        }
        
        .price-item h4 {
            color: #0ea5e9;
            margin-bottom: 10px;
        }
        
        .product-card {
            background: rgba(15, 23, 42, 0.6);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            border-color: rgba(14, 165, 233, 0.5);
            background: rgba(15, 23, 42, 0.8);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.2);
        }

        .product-card-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .product-card-image {
            width: 100%;
            height: 180px;
            background: rgba(100, 116, 139, 0.3);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-card-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .order-card {
            background: rgba(15, 23, 42, 0.6);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .order-email {
            color: #0ea5e9;
            font-weight: 600;
        }

        .order-date {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .order-total {
            color: #10b981;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .order-items {
            margin-top: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            color: #cbd5e1;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .product-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .product-card h3 {
            color: #0ea5e9;
            margin: 0;
        }
        
        .product-card-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-delete {
            background: rgba(239, 68, 68, 0.8);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s ease;
        }
        
        .btn-delete:hover {
            background: rgba(239, 68, 68, 1);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid rgba(14, 165, 233, 0.2);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: #0ea5e9;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #cbd5e1;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: #0ea5e9;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .container {
                padding: 0 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Panel de Administraci√≥n</h1>
        <div class="header-actions">
            <button class="btn btn-primary" id="saveAllBtn">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <a href="index.html" class="btn btn-secondary">
                <i class="fas fa-eye"></i> Ver Sitio
            </a>
            <button class="btn btn-secondary" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
            </button>
        </div>
    </div>
    
    <div class="save-notification" id="saveNotification">
        <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
        <span>Cambios guardados exitosamente</span>
    </div>
    
    <!-- Modal para agregar/editar productos -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nuevo Producto</h2>
                <button class="close-btn" data-action="close-modal">&times;</button>
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label for="productName">Nombre del Producto *</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label for="productDescription">Descripci√≥n *</label>
                    <textarea id="productDescription" required></textarea>
                </div>

                <!-- Calculadora de Precios -->
                <div style="background: rgba(14, 165, 233, 0.1); border: 2px solid rgba(14, 165, 233, 0.3); border-radius: 10px; padding: 16px; margin: 20px 0;">
                    <h3 style="margin: 0 0 16px 0; color: #0ea5e9; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-calculator"></i> Calculadora de Precios
                    </h3>
                    
                    <div class="form-group">
                        <label for="productCost">Costo Estimado (Q) *</label>
                        <input type="number" id="productCost" min="0" step="0.01" placeholder="ej: 120" required>
                        <small style="color: #94a3b8;">Costo total puesto en tus manos</small>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div>
                            <label>Margen Deseado (%)</label>
                            <div style="display: flex; gap: 8px;">
                                <button type="button" class="margin-btn" data-margin="50">50%</button>
                                <button type="button" class="margin-btn" data-margin="55">55%</button>
                            </div>
                        </div>
                        <div>
                            <label>O Ingresa Manual</label>
                            <input type="number" id="productMargin" min="0" max="100" step="1" placeholder="50" value="50" style="padding: 8px; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 6px; color: #cbd5e1; background: rgba(15, 23, 42, 0.4);">
                        </div>
                    </div>

                    <div style="background: rgba(15, 23, 42, 0.6); padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 0.9rem;">
                            <div>
                                <span style="color: #94a3b8;">Ganancia Bruta:</span><br>
                                <span style="color: #10b981; font-weight: bold; font-size: 1.1rem;" id="gananciaDisplay">Q 0.00</span>
                            </div>
                            <div>
                                <span style="color: #94a3b8;">Margen Real:</span><br>
                                <span style="color: #10b981; font-weight: bold; font-size: 1.1rem;" id="margenRealDisplay">0%</span>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(148, 163, 184, 0.2);">
                            <span style="color: #94a3b8;">Precio de Venta Recomendado:</span><br>
                            <span style="color: #0ea5e9; font-weight: bold; font-size: 1.3rem;" id="precioRecomendado">Q 0.00</span>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(148, 163, 184, 0.2); background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: 4px;">
                            <span style="color: #94a3b8; font-size: 0.85rem;">Ganancia Total (despu√©s de descuentos):</span><br>
                            <span style="color: #22c55e; font-weight: bold; font-size: 1.2rem;" id="gananciaTotal">Q 0.00</span>
                            <br><span style="color: #a1a1a1; font-size: 0.75rem; margin-top: 4px; display: block;">-4.83% Paggo | -Q15 Env√≠o</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="productPrice">Precio de Venta Final (Q) *</label>
                    <input type="number" id="productPrice" min="0" step="0.01" required>
                    <small style="color: #94a3b8;">Este ser√° el precio que se mostrar√° en la tienda</small>
                    
                    <!-- Botones para agregar costos -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px;">
                        <button type="button" id="btnAgregarPaggo" style="padding: 10px; background: linear-gradient(135deg, #f97316, #ea580c); border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.9rem;">
                            + Comisi√≥n Paggo (4.83%)
                        </button>
                        <button type="button" id="btnAgregarEnvio" style="padding: 10px; background: linear-gradient(135deg, #06b6d4, #0891b2); border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.9rem;">
                            + Env√≠o (Q15)
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="productStock">Stock Disponible *</label>
                    <input type="number" id="productStock" min="0" required>
                </div>
                <div class="form-group">
                    <label for="productStatus">Estado del Producto *</label>
                    <select id="productStatus" required style="padding: 10px; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 6px; color: #cbd5e1; background: rgba(15, 23, 42, 0.4);">
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="agotado">Agotado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productImage">Im√°genes del Producto (m√∫ltiples) *</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="file" id="productImage" accept="image/*" multiple style="flex: 1; padding: 10px; border: 2px solid rgba(148, 163, 184, 0.2); border-radius: 10px; color: #cbd5e1;">
                        <button type="button" class="btn btn-secondary" data-action="clear-image" style="padding: 8px 16px;">Limpiar</button>
                    </div>
                    <div id="imagePreview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; width: 100%; min-height: 120px; background: rgba(15, 23, 42, 0.6); border: 2px dashed rgba(148, 163, 184, 0.2); border-radius: 8px; padding: 10px; align-content: start;">
                        <div style="grid-column: 1/-1; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 0.9rem; min-height: 120px;">Preview de im√°genes</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="productCategory">Categor√≠a *</label>
                    <input type="text" id="productCategory" placeholder="ej: Combos, Accesorios" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Guardar Producto
                    </button>
                    <button type="button" class="btn btn-secondary" data-action="close-modal" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <style>
        .margin-btn {
            background: rgba(14, 165, 233, 0.2);
            border: 1px solid rgba(14, 165, 233, 0.5);
            color: #0ea5e9;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .margin-btn:hover {
            background: rgba(14, 165, 233, 0.4);
        }
        
        .margin-btn.active {
            background: rgba(14, 165, 233, 0.8);
        }
    </style>
    
    <!-- Modal para agregar/editar clientes -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="clientModalTitle">Nuevo Cliente</h2>
                <button class="close-btn" data-action="close-client-modal">&times;</button>
            </div>
            <form id="clientForm">
                <input type="hidden" id="clientId">
                <div class="form-group">
                    <label for="clientName">Nombre del Proyecto *</label>
                    <input type="text" id="clientName" required placeholder="ej: Restaurante El Buen Sabor">
                </div>
                <div class="form-group">
                    <label for="clientDescription">Descripci√≥n *</label>
                    <textarea id="clientDescription" required placeholder="Breve descripci√≥n del proyecto"></textarea>
                </div>
                <div class="form-group">
                    <label for="clientUrl">URL del Sitio Web *</label>
                    <input type="url" id="clientUrl" required placeholder="https://ejemplo.com">
                    <small style="color: #94a3b8;">URL completa del sitio web del cliente</small>
                </div>
                <div class="form-group">
                    <label for="clientImageUrl">URL de la Imagen *</label>
                    <input type="text" id="clientImageUrl" required placeholder="img/cliente-ejemplo.jpg">
                    <small style="color: #94a3b8;">Ruta relativa o URL completa de la imagen</small>
                </div>
                <div style="background: rgba(14, 165, 233, 0.1); border: 2px solid rgba(14, 165, 233, 0.3); border-radius: 10px; padding: 16px; margin: 20px 0;">
                    <h4 style="margin: 0 0 12px 0; color: #0ea5e9;">
                        <i class="fas fa-image"></i> Subir Imagen
                    </h4>
                    <input type="file" id="clientImageFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px solid rgba(148, 163, 184, 0.2); border-radius: 10px; color: #cbd5e1; margin-bottom: 10px;">
                    <div id="clientImagePreview" style="width: 100%; min-height: 200px; background: rgba(15, 23, 42, 0.6); border: 2px dashed rgba(148, 163, 184, 0.2); border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                        Vista previa de la imagen
                    </div>
                    <small style="color: #94a3b8; display: block; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> Tama√±o recomendado: 800x600px (relaci√≥n 4:3)
                    </small>
                </div>
                <div class="form-group">
                    <label for="clientOrder">Orden de Visualizaci√≥n</label>
                    <input type="number" id="clientOrder" min="0" value="0" placeholder="0">
                    <small style="color: #94a3b8;">Menor n√∫mero aparece primero</small>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="clientActive" checked style="width: 20px; height: 20px;">
                        <span>Cliente Activo (mostrar en la p√°gina)</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Guardar Cliente
                    </button>
                    <button type="button" class="btn btn-secondary" data-action="close-client-modal" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal para agregar/editar demos -->
    <div id="demoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="demoModalTitle">Nuevo Proyecto Demo</h2>
                <button class="close-btn" data-action="close-demo-modal">&times;</button>
            </div>
            <form id="demoForm">
                <input type="hidden" id="demoId">
                <div class="form-group">
                    <label for="demoName">Nombre del Proyecto *</label>
                    <input type="text" id="demoName" required placeholder="ej: Peluquer√≠a Estilo Moderno">
                </div>
                <div class="form-group">
                    <label for="demoDescription">Descripci√≥n *</label>
                    <textarea id="demoDescription" required placeholder="Describe las caracter√≠sticas principales de este demo" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="demoUrl">URL del Demo *</label>
                    <input type="text" id="demoUrl" required placeholder="https://ejemplo.com o #demo-peluqueria">
                    <small style="color: #94a3b8;">URL completa o ancla interna (#demo-nombre)</small>
                </div>
                <div class="form-group">
                    <label for="demoCategory">Categor√≠a *</label>
                    <select id="demoCategory" required style="padding: 10px; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 6px; color: #cbd5e1; background: rgba(15, 23, 42, 0.4); width: 100%;">
                        <option value="">Selecciona una categor√≠a</option>
                        <option value="Peluquer√≠a">Peluquer√≠a / Sal√≥n de Belleza</option>
                        <option value="Restaurante">Restaurante / Caf√©</option>
                        <option value="Tienda">Tienda / E-commerce</option>
                        <option value="Salud">Cl√≠nica / Consultorio M√©dico</option>
                        <option value="Deportes">Gimnasio / Centro Deportivo</option>
                        <option value="Servicios">Servicios Profesionales</option>
                        <option value="Educaci√≥n">Escuela / Academia</option>
                        <option value="Inmobiliaria">Bienes Ra√≠ces</option>
                        <option value="Eventos">Eventos / Catering</option>
                        <option value="Automotriz">Taller / Automotriz</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="demoImageUrl">URL de la Imagen *</label>
                    <input type="text" id="demoImageUrl" required placeholder="img/demo-peluqueria.jpg">
                    <small style="color: #94a3b8;">Ruta relativa o URL completa de la imagen</small>
                </div>
                <div style="background: rgba(14, 165, 233, 0.1); border: 2px solid rgba(14, 165, 233, 0.3); border-radius: 10px; padding: 16px; margin: 20px 0;">
                    <h4 style="margin: 0 0 12px 0; color: #0ea5e9;">
                        <i class="fas fa-image"></i> Subir Imagen
                    </h4>
                    <input type="file" id="demoImageFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px solid rgba(148, 163, 184, 0.2); border-radius: 10px; color: #cbd5e1; margin-bottom: 10px;">
                    <div id="demoImagePreview" style="width: 100%; min-height: 200px; background: rgba(15, 23, 42, 0.6); border: 2px dashed rgba(148, 163, 184, 0.2); border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                        Vista previa de la imagen
                    </div>
                    <small style="color: #94a3b8; display: block; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> Tama√±o recomendado: 800x600px o 1200x800px
                    </small>
                </div>
                <div class="form-group">
                    <label for="demoTecnologias">Tecnolog√≠as Usadas (opcional)</label>
                    <input type="text" id="demoTecnologias" placeholder="ej: React, Node.js, MongoDB">
                    <small style="color: #94a3b8;">Separa con comas las tecnolog√≠as utilizadas</small>
                </div>
                <div class="form-group">
                    <label for="demoOrder">Orden de Visualizaci√≥n</label>
                    <input type="number" id="demoOrder" min="0" value="0" placeholder="0">
                    <small style="color: #94a3b8;">Menor n√∫mero aparece primero</small>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 12px;">
                        <input type="checkbox" id="demoDestacado" style="width: 20px; height: 20px;">
                        <span><i class="fas fa-star" style="color: #f59e0b;"></i> Destacar este demo (aparecer√° primero)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="demoActive" checked style="width: 20px; height: 20px;">
                        <span>Demo Activo (mostrar en la galer√≠a)</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Guardar Demo
                    </button>
                    <button type="button" class="btn btn-secondary" data-action="close-demo-modal" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Testimonio -->
    <div id="testimonioModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="color: #0ea5e9; margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-star"></i>
                <span id="testimonioModalTitle">Agregar Testimonio</span>
            </h3>
            <form id="testimonioForm">
                <input type="hidden" id="testimonioId">
                
                <div class="form-group">
                    <label for="testimonioNombre">Nombre del Cliente *</label>
                    <input type="text" id="testimonioNombre" required placeholder="Ej: Mar√≠a Gonz√°lez">
                </div>
                
                <div class="form-group">
                    <label for="testimonioEmpresa">Empresa</label>
                    <input type="text" id="testimonioEmpresa" placeholder="Ej: Caf√© Arom√°tico">
                </div>
                
                <div class="form-group">
                    <label for="testimonioCargo">Cargo</label>
                    <input type="text" id="testimonioCargo" placeholder="Ej: Gerente General">
                </div>
                
                <div class="form-group">
                    <label for="testimonioTexto">Testimonio *</label>
                    <textarea id="testimonioTexto" required placeholder="Escribe el testimonio del cliente..." style="min-height: 120px;"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="testimonioCalificacion">Calificaci√≥n (1-5 estrellas) *</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="testimonioCalificacion" min="1" max="5" value="5" required style="width: 100px;">
                        <div id="starsPreview" style="color: #f59e0b; font-size: 1.5rem;">
                            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="testimonioProyecto">Proyecto Relacionado</label>
                    <input type="text" id="testimonioProyecto" placeholder="Ej: Chatbot para Restaurante">
                </div>
                
                <div class="form-group">
                    <label for="testimonioFoto">Foto del Cliente (URL o subir archivo)</label>
                    <input type="text" id="testimonioFoto" placeholder="URL de la foto o deja vac√≠o para usar imagen por defecto">
                    <input type="file" id="testimonioFotoFile" accept="image/*" style="margin-top: 10px;">
                    <div id="testimonioFotoPreview" style="margin-top: 10px; max-width: 100px; max-height: 100px;"></div>
                </div>
                
                <div class="form-group">
                    <label for="testimonioFecha">Fecha del Testimonio</label>
                    <input type="date" id="testimonioFecha">
                </div>
                
                <div class="form-group">
                    <label for="testimonioOrden">Orden de aparici√≥n</label>
                    <input type="number" id="testimonioOrden" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="testimonioDestacado" style="width: 20px; height: 20px;">
                        <span><i class="fas fa-star" style="color: #f59e0b;"></i> Destacar (aparecer√° primero)</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="testimonioVerificado" style="width: 20px; height: 20px;">
                        <span><i class="fas fa-check-circle" style="color: #10b981;"></i> Verificado (testimonio aut√©ntico)</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="testimonioActive" checked style="width: 20px; height: 20px;">
                        <span>Activo (mostrar p√∫blicamente)</span>
                    </label>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Guardar Testimonio
                    </button>
                    <button type="button" class="btn btn-secondary" data-action="close-testimonio-modal" style="flex: 1;">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="save-notification" id="saveNotification">
        <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
        <span>Cambios guardados exitosamente</span>
    </div>
    
    <!-- Tabs de navegaci√≥n -->
    <div style="background: rgba(30, 41, 59, 0.9); border-bottom: 2px solid rgba(14, 165, 233, 0.2); padding: 0 40px; display: flex; gap: 30px; margin-top: 20px;">
        <button class="tab-btn active" data-tab="frontal">
            <i class="fas fa-home"></i> Frontal
        </button>
        <button class="tab-btn" data-tab="clientes">
            <i class="fas fa-briefcase"></i> Clientes
        </button>
        <button class="tab-btn" data-tab="demos">
            <i class="fas fa-flask"></i> Demos
        </button>
        <button class="tab-btn" data-tab="testimonios">
            <i class="fas fa-star"></i> Testimonios
        </button>
        <button class="tab-btn" data-tab="tienda">
            <i class="fas fa-store"></i> Tienda
        </button>
        <button class="tab-btn" data-tab="cupones">
            <i class="fas fa-ticket-alt"></i> Cupones
        </button>
    </div>
    
    <style>
        .tab-btn {
            background: transparent;
            border: none;
            color: #cbd5e1;
            padding: 20px 0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 3px solid transparent;
        }
        
        .tab-btn:hover {
            color: #0ea5e9;
        }
        
        .tab-btn.active {
            color: #0ea5e9;
            border-bottom-color: #0ea5e9;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
    
    <div class="container">
        <!-- TAB FRONTAL -->
        <div class="tab-content active" id="tab-frontal">
            <!-- Informaci√≥n Principal -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-info-circle"></i>
                Informaci√≥n Principal
            </h2>
            <div class="grid">
                <div class="form-group">
                    <label for="siteName">Nombre del Sitio</label>
                    <input type="text" id="siteName" value="BotEngine">
                </div>
                <div class="form-group">
                    <label for="siteTagline">Eslogan Principal</label>
                    <input type="text" id="siteTagline" value="Dise√±o y automatizaci√≥n para tu negocio">
                </div>
            </div>
            <div class="form-group">
                <label for="siteDescription">Descripci√≥n</label>
                <textarea id="siteDescription">Impulsamos tu negocio con chatbots, sitios r√°pidos y presencia digital efectiva.</textarea>
            </div>
        </div>
        
        <!-- Informaci√≥n de Contacto -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-phone"></i>
                Informaci√≥n de Contacto
            </h2>
            <div class="grid">
                <div class="form-group">
                    <label for="phone">Tel√©fono / WhatsApp</label>
                    <input type="tel" id="phone" value="+502-3123-9807">
                </div>
                <div class="form-group">
                    <label for="email">Correo Electr√≥nico</label>
                    <input type="email" id="email" value="contacto@botenginecorp.com">
                </div>
            </div>
            <div class="grid">
                <div class="form-group">
                    <label for="instagram">Instagram</label>
                    <input type="text" id="instagram" value="botenginecorp">
                </div>
                <div class="form-group">
                    <label for="linkedin">LinkedIn</label>
                    <input type="text" id="linkedin" value="botenginecorp">
                </div>
            </div>
        </div>
        
        <!-- Servicios -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-cogs"></i>
                Servicios
            </h2>
            
            <div class="form-group">
                <label for="service1Title">Servicio 1 - T√≠tulo</label>
                <input type="text" id="service1Title" value="Chatbots inteligentes">
            </div>
            <div class="form-group">
                <label for="service1Desc">Servicio 1 - Descripci√≥n</label>
                <textarea id="service1Desc">Automatiza respuestas en WhatsApp, Instagram y web para atender a tus clientes 24/7.</textarea>
            </div>
            
            <div class="form-group">
                <label for="service2Title">Servicio 2 - T√≠tulo</label>
                <input type="text" id="service2Title" value="Dise√±o web moderno">
            </div>
            <div class="form-group">
                <label for="service2Desc">Servicio 2 - Descripci√≥n</label>
                <textarea id="service2Desc">Creamos sitios r√°pidos, seguros y optimizados para tu presencia digital.</textarea>
            </div>
            
            <div class="form-group">
                <label for="service3Title">Servicio 3 - T√≠tulo</label>
                <input type="text" id="service3Title" value="Automatizaci√≥n de procesos">
            </div>
            <div class="form-group">
                <label for="service3Desc">Servicio 3 - Descripci√≥n</label>
                <textarea id="service3Desc">Integramos herramientas para ahorrar tiempo en agendamiento, recordatorios y seguimiento.</textarea>
            </div>
        </div>
        </div>
        <!-- FIN TAB FRONTAL -->
        
        <!-- TAB CLIENTES -->
        <div class="tab-content" id="tab-clientes">
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-briefcase"></i>
                Gesti√≥n de Clientes (Portafolio)
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Administra los proyectos que se muestran en la secci√≥n "Nuestros Clientes" de la p√°gina principal
            </p>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-primary" id="addClientBtn" style="margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Agregar Nuevo Cliente
                </button>
            </div>
            
            <div id="clientesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <!-- Los clientes se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
        </div>
        <!-- FIN TAB CLIENTES -->
        
        <!-- TAB DEMOS -->
        <div class="tab-content" id="tab-demos">
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-flask"></i>
                Proyectos Demo / Ejemplos
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Gestiona proyectos de ejemplo que muestran tu trabajo (aunque no sean de clientes reales)
            </p>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-primary" id="addDemoBtn" style="margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Agregar Nuevo Demo
                </button>
            </div>
            
            <div id="demosList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <!-- Los demos se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
        </div>
        <!-- FIN TAB DEMOS -->
        
        <!-- TAB TESTIMONIOS -->
        <div class="tab-content" id="tab-testimonios">
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-star"></i>
                Gesti√≥n de Testimonios y Rese√±as
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Administra las rese√±as y testimonios de tus clientes para mostrar credibilidad y casos de √©xito.
            </p>
            
            <button onclick="openTestimonioModal()" class="btn-primary" style="margin-bottom: 30px;">
                <i class="fas fa-plus-circle"></i>
                Agregar Testimonio
            </button>

            <div id="testimoniosList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
                <!-- Los testimonios se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
        </div>
        <!-- FIN TAB TESTIMONIOS -->
        
        <!-- TAB TIENDA -->
        <div class="tab-content" id="tab-tienda">
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-box"></i>
                Gesti√≥n de Productos y Stock
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Administra los productos y disponibilidad de tu tienda
            </p>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-primary" id="addProductBtn" style="margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Agregar Nuevo Producto
                </button>
            </div>
            
            <div id="productsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
        
        <!-- Pedidos -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-shopping-bag"></i>
                Historial de Pedidos
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Todos los pedidos realizados en tu tienda
            </p>
            
            <div id="ordersList" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                <!-- Los pedidos se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>
        
        <!-- Precios -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-dollar-sign"></i>
                Precios
            </h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> 
                Edita los rangos de precios para cada categor√≠a
            </p>
            
            <div class="price-item">
                <h4>Chatbots</h4>
                <div class="grid">
                    <div class="form-group">
                        <label for="chatbotBasic">B√°sico</label>
                        <input type="text" id="chatbotBasic" value="Q1,500 - Q2,500">
                    </div>
                    <div class="form-group">
                        <label for="chatbotIntermediate">Intermedio</label>
                        <input type="text" id="chatbotIntermediate" value="Q3,500 - Q5,000">
                    </div>
                    <div class="form-group">
                        <label for="chatbotAdvanced">Avanzado</label>
                        <input type="text" id="chatbotAdvanced" value="Q5,500 - Q7,000+">
                    </div>
                </div>
            </div>
            
            <div class="price-item">
                <h4>P√°ginas Web</h4>
                <div class="grid">
                    <div class="form-group">
                        <label for="webBasic">B√°sica</label>
                        <input type="text" id="webBasic" value="Q1,500 - Q2,500">
                    </div>
                    <div class="form-group">
                        <label for="webIntermediate">Intermedia</label>
                        <input type="text" id="webIntermediate" value="Q3,500 - Q5,000">
                    </div>
                    <div class="form-group">
                        <label for="webAdvanced">Avanzada</label>
                        <input type="text" id="webAdvanced" value="Q6,000 - Q8,000+">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="maintenance">Mantenimiento Mensual</label>
                <input type="text" id="maintenance" value="Q200">
            </div>
        </div>
        </div>
        <!-- FIN TAB TIENDA -->

        <!-- TAB CUPONES -->
        <div class="tab-content" id="tab-cupones">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 class="section-title">üéÅ Gesti√≥n de Cupones de Descuento</h2>
                    <button class="btn btn-primary" onclick="window.abrirModalCupon()">
                        <i class="fas fa-plus"></i> Nuevo Cup√≥n
                    </button>
                </div>

                <div id="couponsList">
                    <p style="color: #94a3b8; text-align: center;">Cargando cupones...</p>
                </div>
            </div>
        </div>
        <!-- FIN TAB CUPONES -->

        <!-- Modal Cupones -->
        <div id="couponModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
            <div style="background: rgba(30, 41, 59, 0.95); border: 2px solid rgba(14, 165, 233, 0.3); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="couponModalTitle">Nuevo Cup√≥n</h3>
                    <button onclick="window.cerrarModalCupon()" style="background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer;">‚úï</button>
                </div>

                <form id="couponForm" onsubmit="window.guardarCupon(event)">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>C√≥digo del Cup√≥n</label>
                        <input type="text" id="couponCode" placeholder="Ej: BIENVENIDA2026" required style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>Descripci√≥n</label>
                        <input type="text" id="couponDescription" placeholder="Ej: Descuento de bienvenida 10%" style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Tipo de Descuento</label>
                            <select id="couponType" required style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                                <option value="percentage">Porcentaje (%)</option>
                                <option value="fixed">Cantidad Fija (Q)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Valor</label>
                            <input type="number" id="couponValue" placeholder="Ej: 10 o 50" step="0.01" required style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Compra M√≠nima (Q)</label>
                            <input type="number" id="couponMinPurchase" placeholder="0" step="0.01" min="0" style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                        </div>

                        <div class="form-group">
                            <label>Usos M√°ximos</label>
                            <input type="number" id="couponMaxUses" placeholder="Dejar vac√≠o para ilimitado" min="1" style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                        </div>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>V√°lido Hasta</label>
                        <input type="datetime-local" id="couponValidUntil" required style="width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; color: #f8fafc;">
                    </div>

                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="couponActive" checked>
                            <span>Activo</span>
                        </label>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-save"></i> Guardar Cup√≥n
                        </button>
                        <button type="button" onclick="window.cerrarModalCupon()" class="btn btn-secondary" style="flex: 1;">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script type="module">
      // LIMPIAR CACHE FORZADAMENTE
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }
      
      import { commerceAPI } from './js/commerce-api.js?v=9999';
        // Funci√≥n para cambiar tabs
        function mostrarTab(tabName) {
            // Ocultar todos los tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Quitar clase active de botones
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Mostrar tab seleccionado
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Activar bot√≥n
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Cargar datos espec√≠ficos del tab
            if (tabName === 'clientes') {
                loadClientes();
            } else if (tabName === 'demos') {
                loadDemos();
            } else if (tabName === 'testimonios') {
                loadTestimonios();
            } else if (tabName === 'tienda') {
                loadProducts();
                loadOrders();
            } else if (tabName === 'cupones') {
                if (window.loadCoupons) window.loadCoupons();
            }
        }

        // Event listeners para tabs
        document.querySelectorAll('[data-tab]').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                mostrarTab(tabName);
            });
        });

        // Event listener para cerrar modal
        document.querySelectorAll('[data-action="close-modal"]').forEach(btn => {
            btn.addEventListener('click', closeProductModal);
        });

        // Event listener para limpiar imagen
        document.querySelectorAll('[data-action="clear-image"]').forEach(btn => {
            btn.addEventListener('click', limpiarImagen);
        });

        // Variables globales
        let editingProductId = null;
        let currentImageBase64 = null;
        let adminToken = null;
        
        // Verificar autenticaci√≥n con JWT
        function checkAuthentication() {
            const token = localStorage.getItem('adminToken');
            const user = localStorage.getItem('adminUser');
            
            if (!token || !user) {
                window.location.href = 'admin-login.html';
                return false;
            }
            
            adminToken = token;
            commerceAPI.token = token; // Actualizar token en commerceAPI
            return true;
        }
        
        // Obtener headers con autenticaci√≥n
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${adminToken}`
            };
        }
        
        // Verificar autenticaci√≥n al cargar la p√°gina
        if (!checkAuthentication()) {
            throw new Error('No autorizado');
        }
        
        // Manejar carga de m√∫ltiples im√°genes
        let currentImagesBase64 = [];
        document.getElementById('productImage').addEventListener('change', function(e) {
            const files = e.target.files;
            currentImagesBase64 = [];
            
            if (files.length === 0) {
                document.getElementById('imagePreview').innerHTML = 'Preview de im√°genes';
                return;
            }
            
            let loadedCount = 0;
            document.getElementById('imagePreview').innerHTML = '';
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentImagesBase64.push(event.target.result);
                    loadedCount++;
                    
                    // Mostrar preview de todas
                    const preview = document.getElementById('imagePreview');
                    const imgContainer = document.createElement('div');
                    imgContainer.style.cssText = 'position: relative; cursor: zoom-in;';
                    imgContainer.innerHTML = `
                        <img src="${event.target.result}" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px; transition: transform 0.3s ease;" 
                             onmouseover="this.style.transform='scale(1.5)'; this.style.zIndex='10'; this.style.position='relative';"
                             onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
                    `;
                    preview.appendChild(imgContainer);
                };
                reader.readAsDataURL(file);
            }
        });
        
        function limpiarImagen() {
            currentImagesBase64 = [];
            document.getElementById('productImage').value = '';
            document.getElementById('imagePreview').innerHTML = 'Preview de im√°genes';
        }
        
        // Cargar datos guardados
        function loadData() {
            const savedData = localStorage.getItem('adminData');
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });
            }
            loadProducts();
        }
        
        // Cargar productos
        async function loadProducts() {
            try {
                const products = await commerceAPI.getProducts();
                const productsList = document.getElementById('productsList');
                productsList.innerHTML = '';
                
                if (products.length === 0) {
                    productsList.innerHTML = '<p style="color: #94a3b8; text-align: center; grid-column: 1/-1;">No hay productos agregados a√∫n</p>';
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    const imageHtml = product.image 
                        ? `<img src="${product.image}" alt="${product.name}">` 
                        : '<i class="fas fa-box" style="font-size: 3rem; color: #667eea;"></i>';
                
                    // Badge de estado
                    const statusColor = product.status === 'activo' ? '#10b981' : product.status === 'agotado' ? '#ef4444' : '#94a3b8';
                    const statusText = product.status === 'activo' ? '‚úì Activo' : product.status === 'agotado' ? 'Agotado' : 'Inactivo';
                
                productCard.innerHTML = `
                    <div style="position: absolute; top: 10px; right: 10px; background: ${statusColor}; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                        ${statusText}
                    </div>
                    <div class="product-card-header">
                        <div class="product-card-image">
                            ${imageHtml}
                        </div>
                        <div>
                            <h3 style="color: #f8fafc; margin-bottom: 5px;">${product.name}</h3>
                            <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px;">
                                <i class="fas fa-tag"></i> ${product.category}
                            </p>
                            <p style="color: #cbd5e1; font-size: 0.9rem; line-height: 1.4;">${product.description}</p>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(148, 163, 184, 0.2);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div>
                                <span style="color: #94a3b8; font-size: 0.85rem;">Precio Venta:</span><br>
                                <span style="color: #10b981; font-weight: bold; font-size: 1rem;">Q ${parseFloat(product.price).toFixed(2)}</span>
                            </div>
                            <div>
                                <span style="color: #94a3b8; font-size: 0.85rem;">Costo:</span><br>
                                <span style="color: #94a3b8; font-weight: bold; font-size: 1rem;">Q ${parseFloat(product.cost || 0).toFixed(2)}</span>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; padding: 12px; background: rgba(14, 165, 233, 0.1); border-radius: 6px;">
                            <div>
                                <span style="color: #94a3b8; font-size: 0.85rem;">Stock:</span><br>
                                <span style="color: ${product.stock > 10 ? '#0ea5e9' : product.stock > 0 ? '#f59e0b' : '#ef4444'}; font-weight: bold;">
                                    ${product.stock} unidades
                                </span>
                            </div>
                            <div>
                                <span style="color: #94a3b8; font-size: 0.85rem;">Ventas:</span><br>
                                <span style="color: #0ea5e9; font-weight: bold;">
                                    ${product.sales || 0} unidades
                                </span>
                            </div>
                        </div>
                        <div class="product-card-actions">
                            <button class="btn btn-primary" data-action="edit-product" data-product-id="${product.id}" style="padding: 10px 16px; font-size: 0.85rem; flex: 1;">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn-delete" data-action="delete-product" data-product-id="${product.id}" style="padding: 10px 12px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    productCard.style.position = 'relative';
                productsList.appendChild(productCard);
                });

                // Agregar event listeners a los botones din√°micos
                productsList.querySelectorAll('[data-action="edit-product"]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const productId = parseInt(this.getAttribute('data-product-id'));
                        editProduct(productId);
                    });
                });

                productsList.querySelectorAll('[data-action="delete-product"]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const productId = parseInt(this.getAttribute('data-product-id'));
                        deleteProduct(productId);
                    });
                });
            } catch (error) {
                console.error('Error cargando productos:', error);
            }
        }
        
        // Cargar pedidos
        async function loadOrders() {
            try {
                const orders = await commerceAPI.getOrders();
            const ordersList = document.getElementById('ordersList');
            
            if (!ordersList) return;
            
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p style="color: #94a3b8; text-align: center;">No hay pedidos a√∫n</p>';
                return;
            }
            
            orders.reverse().forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                
                const itemsHTML = order.items.map(item => {
                  const subtotal = parseFloat(item.subtotal) || 0;
                  return `
                    <div class="order-item">
                        <span>${item.nombre} (x${item.cantidad})</span>
                        <span>Q ${subtotal.toFixed(2)}</span>
                    </div>
                  `;
                }).join('');
                
                const total = parseFloat(order.total) || 0;
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div>
                            <div class="order-email"><i class="fas fa-envelope"></i> ${order.email}</div>
                            <div class="order-date"><i class="fas fa-clock"></i> ${order.fecha}</div>
                        </div>
                        <div class="order-total">Q ${total.toFixed(2)}</div>
                    </div>
                    <div class="order-items">
                        ${itemsHTML}
                    </div>
                `;
                
                ordersList.appendChild(orderCard);
            });
            } catch (error) {
                console.error('Error cargando pedidos:', error);
            }
        }

        // ===== CLIENTES (PORTAFOLIO) =====
        let editingClientId = null;

        // Cargar clientes
        async function loadClientes() {
            try {
                const clientes = await commerceAPI.getAllClientes();
                const clientesList = document.getElementById('clientesList');
                clientesList.innerHTML = '';
                
                if (clientes.length === 0) {
                    clientesList.innerHTML = '<p style="color: #94a3b8; text-align: center; grid-column: 1/-1;">No hay clientes agregados a√∫n</p>';
                    return;
                }
                
                clientes.forEach(cliente => {
                    const clientCard = document.createElement('div');
                    clientCard.style.cssText = `
                        background: rgba(30, 41, 59, 0.8);
                        border: 1px solid rgba(14, 165, 233, 0.2);
                        border-radius: 12px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                    `;
                    
                    const activeClass = cliente.activo ? '#10b981' : '#ef4444';
                    const activeText = cliente.activo ? '‚úì Activo' : '‚úó Inactivo';
                    
                    clientCard.innerHTML = `
                        <div style="position: absolute; top: 10px; right: 10px; background: ${activeClass}; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; z-index: 10;">
                            ${activeText}
                        </div>
                        <div style="height: 180px; overflow: hidden; background: linear-gradient(135deg, #1e293b, #334155);">
                            <img src="${cliente.imagen_url}" alt="${cliente.nombre}" 
                                 style="width: 100%; height: 100%; object-fit: cover;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; color: #64748b; font-size: 3rem;">
                                <i class="fas fa-image"></i>
                            </div>
                        </div>
                        <div style="padding: 16px;">
                            <h3 style="color: #f8fafc; margin: 0 0 8px 0; font-size: 1.1rem;">${cliente.nombre}</h3>
                            <p style="color: #94a3b8; margin: 0 0 12px 0; font-size: 0.9rem; line-height: 1.4;">${cliente.descripcion}</p>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <i class="fas fa-link" style="color: #0ea5e9; font-size: 0.9rem;"></i>
                                <a href="${cliente.url}" target="_blank" style="color: #0ea5e9; text-decoration: none; font-size: 0.85rem; word-break: break-all;">
                                    ${cliente.url}
                                </a>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; color: #64748b; font-size: 0.85rem;">
                                <i class="fas fa-sort-numeric-down"></i>
                                <span>Orden: ${cliente.orden}</span>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editCliente(${cliente.id})" class="btn btn-secondary" style="flex: 1; padding: 8px;">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button onclick="deleteCliente(${cliente.id})" class="btn" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #ef4444, #dc2626); border-color: transparent; color: white;">
                                    <i class="fas fa-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    clientesList.appendChild(clientCard);
                });
            } catch (error) {
                console.error('Error cargando clientes:', error);
            }
        }

        // Editar cliente
        async function editCliente(id) {
            try {
                const clientes = await commerceAPI.getAllClientes();
                const cliente = clientes.find(c => c.id === id);
                
                if (!cliente) {
                    alert('Cliente no encontrado');
                    return;
                }
                
                editingClientId = id;
                document.getElementById('clientModalTitle').textContent = 'Editar Cliente';
                document.getElementById('clientId').value = cliente.id;
                document.getElementById('clientName').value = cliente.nombre;
                document.getElementById('clientDescription').value = cliente.descripcion;
                document.getElementById('clientUrl').value = cliente.url;
                document.getElementById('clientImageUrl').value = cliente.imagen_url;
                document.getElementById('clientOrder').value = cliente.orden;
                document.getElementById('clientActive').checked = cliente.activo;
                
                // Mostrar preview de imagen
                const preview = document.getElementById('clientImagePreview');
                preview.innerHTML = `<img src="${cliente.imagen_url}" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
                
                document.getElementById('clientModal').classList.add('active');
            } catch (error) {
                console.error('Error al editar cliente:', error);
                alert('Error al cargar datos del cliente');
            }
        }

        // Eliminar cliente
        async function deleteCliente(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este cliente?')) return;
            
            try {
                await commerceAPI.deleteCliente(id);
                await loadClientes();
                showNotification('Cliente eliminado correctamente');
            } catch (error) {
                console.error('Error eliminando cliente:', error);
                alert('Error al eliminar cliente');
            }
        }

        // Funci√≥n auxiliar para cargar tabs
        window.editCliente = editCliente;
        window.deleteCliente = deleteCliente;

        // ===== PROYECTOS DEMO =====
        let editingDemoId = null;

        // Cargar demos
        async function loadDemos() {
            try {
                const demos = await commerceAPI.getAllDemos();
                const demosList = document.getElementById('demosList');
                demosList.innerHTML = '';
                
                if (demos.length === 0) {
                    demosList.innerHTML = '<p style="color: #94a3b8; text-align: center; grid-column: 1/-1;">No hay demos agregados a√∫n</p>';
                    return;
                }
                
                demos.forEach(demo => {
                    const demoCard = document.createElement('div');
                    demoCard.style.cssText = `
                        background: rgba(30, 41, 59, 0.8);
                        border: 1px solid rgba(14, 165, 233, 0.2);
                        border-radius: 12px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                        position: relative;
                    `;
                    
                    const activeClass = demo.activo ? '#10b981' : '#ef4444';
                    const activeText = demo.activo ? '‚úì Activo' : '‚úó Inactivo';
                    const destacadoBadge = demo.destacado ? '<div style="position: absolute; top: 10px; left: 10px; background: #f59e0b; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; z-index: 10;"><i class="fas fa-star"></i> Destacado</div>' : '';
                    
                    demoCard.innerHTML = `
                        ${destacadoBadge}
                        <div style="position: absolute; top: 10px; right: 10px; background: ${activeClass}; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; z-index: 10;">
                            ${activeText}
                        </div>
                        <div style="height: 180px; overflow: hidden; background: linear-gradient(135deg, #1e293b, #334155);">
                            <img src="${demo.imagen_url}" alt="${demo.nombre}" 
                                 style="width: 100%; height: 100%; object-fit: cover;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; color: #64748b; font-size: 3rem;">
                                <i class="fas fa-flask"></i>
                            </div>
                        </div>
                        <div style="padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="background: rgba(139, 92, 246, 0.2); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                    ${demo.categoria}
                                </span>
                            </div>
                            <h3 style="color: #f8fafc; margin: 0 0 8px 0; font-size: 1.1rem;">${demo.nombre}</h3>
                            <p style="color: #94a3b8; margin: 0 0 12px 0; font-size: 0.9rem; line-height: 1.4;">${demo.descripcion}</p>
                            ${demo.tecnologias ? `
                                <div style="margin-bottom: 12px; color: #64748b; font-size: 0.8rem;">
                                    <i class="fas fa-code"></i> ${demo.tecnologias}
                                </div>
                            ` : ''}
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <i class="fas fa-link" style="color: #0ea5e9; font-size: 0.9rem;"></i>
                                <span style="color: #0ea5e9; font-size: 0.85rem; word-break: break-all;">
                                    ${demo.url}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; color: #64748b; font-size: 0.85rem;">
                                <i class="fas fa-sort-numeric-down"></i>
                                <span>Orden: ${demo.orden}</span>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editDemo(${demo.id})" class="btn btn-secondary" style="flex: 1; padding: 8px;">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button onclick="deleteDemo(${demo.id})" class="btn" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #ef4444, #dc2626); border-color: transparent; color: white;">
                                    <i class="fas fa-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    demosList.appendChild(demoCard);
                });
            } catch (error) {
                console.error('Error cargando demos:', error);
            }
        }

        // Editar demo
        async function editDemo(id) {
            try {
                const demos = await commerceAPI.getAllDemos();
                const demo = demos.find(d => d.id === id);
                
                if (!demo) {
                    alert('Demo no encontrado');
                    return;
                }
                
                editingDemoId = id;
                document.getElementById('demoModalTitle').textContent = 'Editar Demo';
                document.getElementById('demoId').value = demo.id;
                document.getElementById('demoName').value = demo.nombre;
                document.getElementById('demoDescription').value = demo.descripcion;
                document.getElementById('demoUrl').value = demo.url;
                document.getElementById('demoCategory').value = demo.categoria;
                document.getElementById('demoImageUrl').value = demo.imagen_url;
                document.getElementById('demoTecnologias').value = demo.tecnologias || '';
                document.getElementById('demoOrder').value = demo.orden;
                document.getElementById('demoDestacado').checked = demo.destacado;
                document.getElementById('demoActive').checked = demo.activo;
                
                // Mostrar preview de imagen
                const preview = document.getElementById('demoImagePreview');
                preview.innerHTML = `<img src="${demo.imagen_url}" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
                
                document.getElementById('demoModal').classList.add('active');
            } catch (error) {
                console.error('Error al editar demo:', error);
                alert('Error al cargar datos del demo');
            }
        }

        // Eliminar demo
        async function deleteDemo(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este demo?')) return;
            
            try {
                await commerceAPI.deleteDemo(id);
                await loadDemos();
                showNotification('Demo eliminado correctamente');
            } catch (error) {
                console.error('Error eliminando demo:', error);
                alert('Error al eliminar demo');
            }
        }

        // Funci√≥n auxiliar para cargar tabs
        window.editDemo = editDemo;
        window.deleteDemo = deleteDemo;

        // ===== TESTIMONIOS =====
        let editingTestimonioId = null;

        // Cargar testimonios
        async function loadTestimonios() {
            try {
                const testimonios = await commerceAPI.getAllTestimonios();
                const container = document.getElementById('testimoniosList');
                
                if (!testimonios || testimonios.length === 0) {
                    container.innerHTML = '<p style="color: #94a3b8; grid-column: 1/-1;">No hay testimonios. Agrega el primer testimonio.</p>';
                    return;
                }
                
                container.innerHTML = testimonios.map(t => `
                    <div style="background: rgba(15, 23, 42, 0.6); border: 2px solid rgba(148, 163, 184, 0.2); border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: start; gap: 15px; margin-bottom: 15px;">
                            <img src="${t.foto_url || 'img/avatar-default.svg'}" 
                                 alt="${t.nombre_cliente}" 
                                 style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #0ea5e9;">
                            <div style="flex: 1;">
                                <h3 style="color: #f8fafc; margin: 0 0 5px 0; font-size: 1.1rem;">
                                    ${t.nombre_cliente}
                                    ${t.verificado ? '<i class="fas fa-check-circle" style="color: #10b981; font-size: 0.9rem;" title="Verificado"></i>' : ''}
                                </h3>
                                <div style="color: #94a3b8; font-size: 0.9rem;">
                                    ${t.empresa ? `<div><i class="fas fa-building"></i> ${t.empresa}</div>` : ''}
                                    ${t.cargo ? `<div><i class="fas fa-user-tie"></i> ${t.cargo}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="color: #f59e0b; margin-bottom: 8px; font-size: 1.2rem;">
                                ${'‚òÖ'.repeat(t.calificacion || 5)}${'‚òÜ'.repeat(5 - (t.calificacion || 5))}
                            </div>
                            <p style="color: #cbd5e1; font-style: italic; line-height: 1.6; margin: 0;">
                                "${t.testimonio.substring(0, 150)}${t.testimonio.length > 150 ? '...' : ''}"
                            </p>
                        </div>
                        
                        ${t.proyecto_relacionado ? `
                            <div style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 15px;">
                                <i class="fas fa-project-diagram"></i> ${t.proyecto_relacionado}
                            </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                            ${t.destacado ? '<span style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem;"><i class="fas fa-star"></i> Destacado</span>' : ''}
                            ${t.activo ? '<span style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem;"><i class="fas fa-check"></i> Activo</span>' : '<span style="background: #64748b; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem;"><i class="fas fa-times"></i> Inactivo</span>'}
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="editTestimonio(${t.id})" class="btn btn-primary" style="flex: 1;">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button onclick="deleteTestimonio(${t.id})" class="btn btn-danger" style="flex: 1;">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error cargando testimonios:', error);
                document.getElementById('testimoniosList').innerHTML = '<p style="color: #ef4444;">Error al cargar testimonios</p>';
            }
        }

        // Abrir modal de testimonio
        window.openTestimonioModal = function(id = null) {
            editingTestimonioId = id;
            const modal = document.getElementById('testimonioModal');
            const title = document.getElementById('testimonioModalTitle');
            const form = document.getElementById('testimonioForm');
            
            form.reset();
            
            if (id) {
                title.textContent = 'Editar Testimonio';
                loadTestimonioData(id);
            } else {
                title.textContent = 'Agregar Testimonio';
                document.getElementById('testimonioFecha').valueAsDate = new Date();
            }
            
            modal.style.display = 'flex';
        }

        // Cargar datos de testimonio
        async function loadTestimonioData(id) {
            try {
                const testimonios = await commerceAPI.getAllTestimonios();
                const testimonio = testimonios.find(t => t.id === id);
                
                if (testimonio) {
                    document.getElementById('testimonioId').value = testimonio.id;
                    document.getElementById('testimonioNombre').value = testimonio.nombre_cliente;
                    document.getElementById('testimonioEmpresa').value = testimonio.empresa || '';
                    document.getElementById('testimonioCargo').value = testimonio.cargo || '';
                    document.getElementById('testimonioTexto').value = testimonio.testimonio;
                    document.getElementById('testimonioCalificacion').value = testimonio.calificacion || 5;
                    document.getElementById('testimonioProyecto').value = testimonio.proyecto_relacionado || '';
                    document.getElementById('testimonioFoto').value = testimonio.foto_url || '';
                    
                    if (testimonio.fecha_testimonio) {
                        document.getElementById('testimonioFecha').value = testimonio.fecha_testimonio.split('T')[0];
                    }
                    
                    document.getElementById('testimonioOrden').value = testimonio.orden || 0;
                    document.getElementById('testimonioDestacado').checked = testimonio.destacado || false;
                    document.getElementById('testimonioVerificado').checked = testimonio.verificado || false;
                    document.getElementById('testimonioActive').checked = testimonio.activo !== false;
                    
                    updateStarsPreview(testimonio.calificacion || 5);
                }
            } catch (error) {
                console.error('Error cargando datos del testimonio:', error);
            }
        }

        // Actualizar preview de estrellas
        function updateStarsPreview(rating) {
            const preview = document.getElementById('starsPreview');
            if (preview) {
                preview.innerHTML = '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
            }
        }

        // Event listener para calificaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            const calificacionInput = document.getElementById('testimonioCalificacion');
            if (calificacionInput) {
                calificacionInput.addEventListener('input', (e) => {
                    updateStarsPreview(parseInt(e.target.value) || 5);
                });
            }
        });

        // Manejar env√≠o de formulario
        document.getElementById('testimonioForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const testimonioData = {
                nombre_cliente: document.getElementById('testimonioNombre').value.trim(),
                empresa: document.getElementById('testimonioEmpresa').value.trim(),
                cargo: document.getElementById('testimonioCargo').value.trim(),
                testimonio: document.getElementById('testimonioTexto').value.trim(),
                calificacion: parseInt(document.getElementById('testimonioCalificacion').value),
                proyecto_relacionado: document.getElementById('testimonioProyecto').value.trim(),
                foto_url: document.getElementById('testimonioFoto').value.trim() || 'img/avatar-default.svg',
                fecha_testimonio: document.getElementById('testimonioFecha').value || new Date().toISOString().split('T')[0],
                orden: parseInt(document.getElementById('testimonioOrden').value) || 0,
                destacado: document.getElementById('testimonioDestacado').checked,
                verificado: document.getElementById('testimonioVerificado').checked,
                activo: document.getElementById('testimonioActive').checked
            };
            
            try {
                if (editingTestimonioId) {
                    await commerceAPI.updateTestimonio(editingTestimonioId, testimonioData);
                    showNotification('Testimonio actualizado correctamente');
                } else {
                    await commerceAPI.createTestimonio(testimonioData);
                    showNotification('Testimonio creado correctamente');
                }
                
                document.getElementById('testimonioModal').style.display = 'none';
                await loadTestimonios();
            } catch (error) {
                console.error('Error guardando testimonio:', error);
                alert('Error al guardar el testimonio');
            }
        });

        // Editar testimonio
        window.editTestimonio = async function(id) {
            openTestimonioModal(id);
        }

        // Eliminar testimonio
        window.deleteTestimonio = async function(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este testimonio?')) return;
            
            try {
                await commerceAPI.deleteTestimonio(id);
                await loadTestimonios();
                showNotification('Testimonio eliminado correctamente');
            } catch (error) {
                console.error('Error eliminando testimonio:', error);
                alert('Error al eliminar testimonio');
            }
        }

        // Cerrar modal
        document.querySelectorAll('[data-action="close-testimonio-modal"]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('testimonioModal').style.display = 'none';
            });
        });

        // ===== CUPONES =====
        let editingCouponId = null;

        // Cargar cupones
        window.loadCoupons = async function loadCoupons() {

            try {
                const response = await fetch('/api/commerce/coupons', {
                    headers: getAuthHeaders()
                });
                const coupons = await response.json();
                const couponsList = document.getElementById('couponsList');
                couponsList.innerHTML = '';

                if (!coupons || coupons.length === 0) {
                    couponsList.innerHTML = '<p style="color: #94a3b8; text-align: center;">No hay cupones creados a√∫n</p>';
                    return;
                }

                coupons.forEach(coupon => {
                    const expirado = new Date(coupon.valid_until) < new Date();
                    const couponCard = document.createElement('div');
                    couponCard.style.cssText = 'background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(14, 165, 233, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;';
                    
                    const tipoDescuento = coupon.discount_type === 'percentage' ? '%' : 'Q';
                    couponCard.innerHTML = `
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                <span style="background: rgba(14, 165, 233, 0.2); color: #0ea5e9; padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 1.1rem;">${coupon.code}</span>
                                <span style="color: #10b981; font-weight: 600;">-${coupon.discount_value}${tipoDescuento}</span>
                                ${coupon.is_active ? '<span style="background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">Activo</span>' : '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">Inactivo</span>'}
                                ${expirado ? '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">Expirado</span>' : ''}
                            </div>
                            <p style="color: #cbd5e1; margin-bottom: 8px;">${coupon.description || 'Sin descripci√≥n'}</p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.85rem;">
                                <div style="color: #94a3b8;">Min. compra: <span style="color: #f8fafc;">Q ${coupon.min_purchase || 0}</span></div>
                                <div style="color: #94a3b8;">Usos: <span style="color: #f8fafc;">${coupon.current_uses}${coupon.max_uses ? '/' + coupon.max_uses : '/‚àû'}</span></div>
                                <div style="color: #94a3b8;">V√°lido hasta: <span style="color: #f8fafc;">${new Date(coupon.valid_until).toLocaleDateString('es-ES')}</span></div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; margin-left: 15px;">
                            <button onclick="window.editarCupon(${coupon.id})" class="btn btn-primary" style="padding: 8px 12px; font-size: 0.85rem;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="window.eliminarCupon(${coupon.id})" class="btn-delete" style="padding: 8px 12px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    couponsList.appendChild(couponCard);
                });
            } catch (error) {
                console.error('Error cargando cupones:', error);
            }
        }

        // Abrir modal cup√≥n
        window.abrirModalCupon = function() {
            editingCouponId = null;
            document.getElementById('couponModalTitle').textContent = 'Nuevo Cup√≥n';
            document.getElementById('couponForm').reset();
            document.getElementById('couponActive').checked = true;
            document.getElementById('couponModal').style.display = 'flex';
        }

        // Cerrar modal cup√≥n
        window.cerrarModalCupon = function() {
            document.getElementById('couponModal').style.display = 'none';
        }

        // Editar cup√≥n
        window.editarCupon = async function(couponId) {
            try {
                const response = await fetch('/api/commerce/coupons', {
                    headers: getAuthHeaders()
                });
                const coupons = await response.json();
                const coupon = coupons.find(c => c.id === couponId);

                if (!coupon) return;

                editingCouponId = couponId;
                document.getElementById('couponModalTitle').textContent = 'Editar Cup√≥n';
                document.getElementById('couponCode').value = coupon.code;
                document.getElementById('couponDescription').value = coupon.description || '';
                document.getElementById('couponType').value = coupon.discount_type;
                document.getElementById('couponValue').value = coupon.discount_value;
                document.getElementById('couponMinPurchase').value = coupon.min_purchase || 0;
                document.getElementById('couponMaxUses').value = coupon.max_uses || '';
                document.getElementById('couponActive').checked = coupon.is_active;

                // Convertir a datetime-local
                const date = new Date(coupon.valid_until);
                document.getElementById('couponValidUntil').value = date.toISOString().slice(0, 16);

                document.getElementById('couponModal').style.display = 'flex';
            } catch (error) {
                console.error('Error editando cup√≥n:', error);
            }
        }

        // Guardar cup√≥n
        window.guardarCupon = async function(event) {
            event.preventDefault();

            const couponData = {
                code: document.getElementById('couponCode').value.toUpperCase(),
                description: document.getElementById('couponDescription').value,
                discount_type: document.getElementById('couponType').value,
                discount_value: parseFloat(document.getElementById('couponValue').value),
                min_purchase: parseFloat(document.getElementById('couponMinPurchase').value) || 0,
                max_uses: document.getElementById('couponMaxUses').value ? parseInt(document.getElementById('couponMaxUses').value) : null,
                valid_until: document.getElementById('couponValidUntil').value,
                is_active: document.getElementById('couponActive').checked
            };

            try {
                const url = editingCouponId ? `/api/commerce/coupons/${editingCouponId}` : '/api/commerce/coupons';
                const method = editingCouponId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: getAuthHeaders(),
                    body: JSON.stringify(couponData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'No se pudo guardar el cup√≥n'));
                    return;
                }

                alert(editingCouponId ? 'Cup√≥n actualizado' : 'Cup√≥n creado');
                window.cerrarModalCupon();
                window.loadCoupons();
            } catch (error) {
                console.error('Error guardando cup√≥n:', error);
                alert('Error al guardar el cup√≥n');
            }
        }

        // Eliminar cup√≥n
        window.eliminarCupon = async function(couponId) {
            if (!confirm('¬øEst√°s seguro de que deseas eliminar este cup√≥n?')) return;

            try {
                const response = await fetch(`/api/commerce/coupons/${couponId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });

                if (!response.ok) {
                    alert('Error al eliminar el cup√≥n');
                    return;
                }

                alert('Cup√≥n eliminado');
                window.loadCoupons();
            } catch (error) {
                console.error('Error eliminando cup√≥n:', error);
                alert('Error al eliminar el cup√≥n');
            }
        }
        
        // Abrir modal para nuevo cliente
        document.getElementById('addClientBtn').addEventListener('click', () => {
            editingClientId = null;
            document.getElementById('clientModalTitle').textContent = 'Nuevo Cliente';
            document.getElementById('clientForm').reset();
            document.getElementById('clientActive').checked = true;
            document.getElementById('clientOrder').value = 0;
            document.getElementById('clientImagePreview').innerHTML = 'Vista previa de la imagen';
            document.getElementById('clientModal').classList.add('active');
        });
        
        // Cerrar modal de clientes
        function closeClientModal() {
            document.getElementById('clientModal').classList.remove('active');
            document.getElementById('clientForm').reset();
            document.getElementById('clientImagePreview').innerHTML = 'Vista previa de la imagen';
            editingClientId = null;
        }
        
        // Cerrar modal con botones
        document.querySelectorAll('[data-action="close-client-modal"]').forEach(btn => {
            btn.addEventListener('click', closeClientModal);
        });
        
        // Preview de imagen de cliente
        document.getElementById('clientImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('clientImagePreview');
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
                    // Actualizar tambi√©n el campo de URL con el nombre del archivo
                    document.getElementById('clientImageUrl').value = `img/${file.name}`;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Guardar cliente (crear o actualizar)
        document.getElementById('clientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const clienteData = {
                nombre: document.getElementById('clientName').value,
                descripcion: document.getElementById('clientDescription').value,
                url: document.getElementById('clientUrl').value,
                imagen_url: document.getElementById('clientImageUrl').value,
                orden: parseInt(document.getElementById('clientOrder').value) || 0,
                activo: document.getElementById('clientActive').checked
            };
            
            try {
                if (editingClientId) {
                    await commerceAPI.updateCliente(editingClientId, clienteData);
                    showNotification('Cliente actualizado correctamente');
                } else {
                    await commerceAPI.createCliente(clienteData);
                    showNotification('Cliente creado correctamente');
                }
                
                closeClientModal();
                await loadClientes();
            } catch (error) {
                console.error('Error guardando cliente:', error);
                alert('Error al guardar cliente: ' + error.message);
            }
        });
        
        // ===== EVENT LISTENERS DEMOS =====
        
        // Abrir modal para nuevo demo
        document.getElementById('addDemoBtn').addEventListener('click', () => {
            editingDemoId = null;
            document.getElementById('demoModalTitle').textContent = 'Nuevo Proyecto Demo';
            document.getElementById('demoForm').reset();
            document.getElementById('demoActive').checked = true;
            document.getElementById('demoDestacado').checked = false;
            document.getElementById('demoOrder').value = 0;
            document.getElementById('demoImagePreview').innerHTML = 'Vista previa de la imagen';
            document.getElementById('demoModal').classList.add('active');
        });
        
        // Cerrar modal de demos
        function closeDemoModal() {
            document.getElementById('demoModal').classList.remove('active');
            document.getElementById('demoForm').reset();
            document.getElementById('demoImagePreview').innerHTML = 'Vista previa de la imagen';
            editingDemoId = null;
        }
        
        // Cerrar modal con botones
        document.querySelectorAll('[data-action="close-demo-modal"]').forEach(btn => {
            btn.addEventListener('click', closeDemoModal);
        });
        
        // Preview de imagen de demo
        document.getElementById('demoImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('demoImagePreview');
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
                    // Actualizar tambi√©n el campo de URL con el nombre del archivo
                    document.getElementById('demoImageUrl').value = `img/${file.name}`;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Guardar demo (crear o actualizar)
        document.getElementById('demoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const demoData = {
                nombre: document.getElementById('demoName').value,
                descripcion: document.getElementById('demoDescription').value,
                url: document.getElementById('demoUrl').value,
                imagen_url: document.getElementById('demoImageUrl').value,
                categoria: document.getElementById('demoCategory').value,
                tecnologias: document.getElementById('demoTecnologias').value || null,
                destacado: document.getElementById('demoDestacado').checked,
                orden: parseInt(document.getElementById('demoOrder').value) || 0,
                activo: document.getElementById('demoActive').checked
            };
            
            try {
                if (editingDemoId) {
                    await commerceAPI.updateDemo(editingDemoId, demoData);
                    showNotification('Demo actualizado correctamente');
                } else {
                    await commerceAPI.createDemo(demoData);
                    showNotification('Demo creado correctamente');
                }
                
                closeDemoModal();
                await loadDemos();
            } catch (error) {
                console.error('Error guardando demo:', error);
                alert('Error al guardar demo: ' + error.message);
            }
        });
        
        // Abrir modal para nuevo producto
        document.getElementById('addProductBtn').addEventListener('click', () => {
            editingProductId = null;
            currentImageBase64 = null;
            document.getElementById('modalTitle').textContent = 'Nuevo Producto';
            document.getElementById('productForm').reset();
            document.getElementById('productStatus').value = 'activo';
            document.getElementById('productMargin').value = 50;
            document.getElementById('imagePreview').innerHTML = 'Preview de la imagen';
            document.getElementById('productModal').classList.add('active');
        });
        
        // Cerrar modal
        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
            document.getElementById('productForm').reset();
            document.getElementById('imagePreview').innerHTML = 'Preview de la imagen';
            editingProductId = null;
            currentImageBase64 = null;
        }
        
        // Editar producto
        async function editProduct(id) {
            try {
                const products = await commerceAPI.getProducts();
                const product = products.find(p => p.id === id);
                
                if (product) {
                    editingProductId = id;
                    currentImageBase64 = product.image || null;
                document.getElementById('modalTitle').textContent = 'Editar Producto';
                document.getElementById('productName').value = product.name;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productCost').value = product.cost || 0;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productStatus').value = product.status || 'activo';
                document.getElementById('productMargin').value = product.margin || 50;
                document.getElementById('productImage').value = '';
                
                // Mostrar preview si existe imagen
                if (product.image) {
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = `<img src="${product.image}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
                } else {
                    document.getElementById('imagePreview').innerHTML = 'Preview de la imagen';
                }
                
                document.getElementById('productModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error editando producto:', error);
            }
        }
        
        // Eliminar producto
        async function deleteProduct(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                try {
                    await commerceAPI.deleteProduct(id);
                loadProducts();
                } catch (error) {
                    console.error('Error eliminando producto:', error);
                    alert('Error eliminando producto');
                }
            }
        }
        
        // ===== CALCULADORA DE PRECIOS =====
        function actualizarCalculadora() {
            const costInput = document.getElementById('productCost');
            const marginInput = document.getElementById('productMargin');
            const priceInput = document.getElementById('productPrice');
            
            const costo = parseFloat(costInput.value) || 0;
            const margen = parseInt(marginInput.value) || 50;
            
            if (costo > 0) {
                const ganancia = (costo * margen) / 100;
                const precioVenta = costo + ganancia;
                const margenReal = (ganancia / precioVenta * 100).toFixed(1);
                
                document.getElementById('gananciaDisplay').textContent = `Q ${ganancia.toFixed(2)}`;
                document.getElementById('margenRealDisplay').textContent = `${margenReal}%`;
                document.getElementById('precioRecomendado').textContent = `Q ${precioVenta.toFixed(2)}`;
                document.getElementById('gananciaTotal').textContent = `Q ${ganancia.toFixed(2)}`;
                
                // Auto-llenar el precio de venta
                priceInput.value = precioVenta.toFixed(2);
            }
        }
        
        // Event listeners para calculadora
        document.getElementById('productCost').addEventListener('input', actualizarCalculadora);
        document.getElementById('productMargin').addEventListener('input', actualizarCalculadora);
        
        // Botones para agregar costos al precio final
        document.getElementById('btnAgregarPaggo').addEventListener('click', (e) => {
            e.preventDefault();
            const priceInput = document.getElementById('productPrice');
            const precioActual = parseFloat(priceInput.value) || 0;
            if (precioActual > 0) {
                const comision = precioActual * 0.0483;
                const nuevoPrecio = precioActual + comision;
                priceInput.value = nuevoPrecio.toFixed(2);
            }
        });
        
        document.getElementById('btnAgregarEnvio').addEventListener('click', (e) => {
            e.preventDefault();
            const priceInput = document.getElementById('productPrice');
            const precioActual = parseFloat(priceInput.value) || 0;
            const nuevoPrecio = precioActual + 15;
            priceInput.value = nuevoPrecio.toFixed(2);
        });
        
        // Botones de margen r√°pido
        document.querySelectorAll('.margin-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const margin = btn.getAttribute('data-margin');
                document.getElementById('productMargin').value = margin;
                document.querySelectorAll('.margin-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                actualizarCalculadora();
            });
        });
        
        // Guardar producto
        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (currentImagesBase64.length === 0 && !editingProductId) {
                alert('Por favor selecciona al menos una imagen para el producto');
                return;
            }
            
            const productData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                image: currentImagesBase64[0] || null,
                images: currentImagesBase64.map((img, idx) => ({ url: img, alt: `${document.getElementById('productName').value} ${idx + 1}` })),
                category: document.getElementById('productCategory').value,
                cost: parseFloat(document.getElementById('productCost').value),
                margin: parseInt(document.getElementById('productMargin').value) || 50,
                status: document.getElementById('productStatus').value || 'activo'
            };
            
            try {
                if (editingProductId) {
                    await commerceAPI.updateProduct(editingProductId, productData);
                } else {
                    await commerceAPI.createProduct(productData);
                }
                
                closeProductModal();
                await loadProducts();
                showNotification();
            } catch (error) {
                console.error('Error guardando producto:', error);
                alert('Error guardando producto');
            }
        });
        
        // Guardar datos general
        function saveData() {
            const data = {};
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
            inputs.forEach(input => {
                if (input.id && !input.id.startsWith('product')) {
                    data[input.id] = input.value;
                }
            });
            
            localStorage.setItem('adminData', JSON.stringify(data));
            showNotification();
        }
        
        // Mostrar notificaci√≥n
        function showNotification() {
            const notification = document.getElementById('saveNotification');
            notification.style.display = 'flex';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Event listeners
        document.getElementById('saveAllBtn').addEventListener('click', saveData);
        
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                // Limpiar JWT y datos de usuario de localStorage
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                localStorage.removeItem('adminTokenExpiry');
                // Limpiar token del API
                commerceAPI.token = null;
                // Redirigir al login
                window.location.href = 'admin-login.html';
            }
        });
        
        // NO cerrar modal al hacer click fuera - solo con bot√≥n de cerrar
        // Modal se cierra solo con el bot√≥n X
        
        // Cargar datos al iniciar
        loadData();
        loadOrders();
        window.loadCoupons();
        
        // Auto-guardar cada 30 segundos
        setInterval(() => {
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
            let hasChanges = false;
            
            inputs.forEach(input => {
                if (input.dataset.originalValue !== input.value) {
                    hasChanges = true;
                }
            });
            
            if (hasChanges) {
                saveData();
            }
        }, 30000);
        
        // Guardar valores originales para detectar cambios
        window.addEventListener('load', () => {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.dataset.originalValue = input.value;
            });
        });
    </script>
</body>
</html>
